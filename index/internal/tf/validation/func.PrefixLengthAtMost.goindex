package github.com/hashicorp/terraform-provider-azuread/internal/tf/validation
import (
	"fmt"
	"net/netip"
)
func PrefixLengthAtMost(maxLength int) func(interface{}, string) ([]string, []error) {
	return func(i interface{}, k string) (warnings []string, errors []error) {
		if warnings, errors = StringIsNotEmpty(i, k); len(errors) > 0 {
			return warnings, errors
		}

		prefix, err := netip.ParsePrefix(i.(string))
		if err != nil {
			return nil, []error{fmt.Errorf("expected %q to be a valid IPv4 or IPv6 prefix", k)}
		}

		if prefixLength := prefix.Bits(); prefixLength > maxLength {
			return nil, []error{fmt.Errorf("expected %q to have a prefix length at most %d, got %d", k, maxLength, prefixLength)}
		}

		return
	}
}
